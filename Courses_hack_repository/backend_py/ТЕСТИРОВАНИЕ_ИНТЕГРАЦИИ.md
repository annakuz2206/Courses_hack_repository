# üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Telegram –±–æ—Ç–∞ —Å —Å–∞–π—Ç–æ–º

## –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç —á–µ—Ä–µ–∑ Swagger UI

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥

–í –ø–µ—Ä–≤–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
cd backend_py
source ../.venv/bin/activate
export JWT_SECRET="test_secret"
python3 main.py
```

–ò–ª–∏ —á–µ—Ä–µ–∑ uvicorn:

```bash
cd backend_py
source ../.venv/bin/activate
export JWT_SECRET="test_secret"
uvicorn main:app --host 0.0.0.0 --port 8000 --reload
```

–°–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –Ω–∞: `http://localhost:8000`

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ: –æ—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8000/health - –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å `{"status": "ok"}`

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç–µ Telegram –±–æ—Ç–∞

–í–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ:

```bash
cd backend_py
source ../.venv/bin/activate
export TELEGRAM_BOT_TOKEN="–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞"
export SITE_URL="http://localhost:3000"  # –∏–ª–∏ –≤–∞—à —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ URL
python3 telegram_bot.py
```

–ë–æ—Ç –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏.

### –®–∞–≥ 3: –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/login`
4. –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–∞–º –∫–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: `XBjuX-86tDnYkLfQEsguoA`)
5. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥** - –æ–Ω –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 4: –û—Ç–∫—Ä–æ–π—Ç–µ Swagger UI

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: http://localhost:8000/docs

### –®–∞–≥ 5: –¢–µ—Å—Ç 1 - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (–±–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

1. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/auth/bot-code/validate/{code}`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –í –ø–æ–ª–µ `code` –≤—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–ª—É—á–∏–ª–∏ –æ—Ç –±–æ—Ç–∞
4. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (200):**
```json
{
  "valid": true,
  "message": "–ö–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω",
  "user_name": "–í–∞—à–µ –∏–º—è"
}
```

### –®–∞–≥ 6: –¢–µ—Å—Ç 2 - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∫–æ–¥

1. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `POST /api/auth/bot-code`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –í –ø–æ–ª–µ `code` –≤—Å—Ç–∞–≤—å—Ç–µ —Ç–æ—Ç –∂–µ –∫–æ–¥:
```json
{
  "code": "–≤–∞—à_–∫–æ–¥_–æ—Ç_–±–æ—Ç–∞"
}
```
4. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (200):**
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGc...",
  "token_type": "bearer"
}
```

### –®–∞–≥ 7: –¢–µ—Å—Ç 3 - –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –∫–æ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω

1. –°–Ω–æ–≤–∞ –≤—ã–∑–æ–≤–∏—Ç–µ `GET /api/auth/bot-code/validate/{code}` —Å —Ç–µ–º –∂–µ –∫–æ–¥–æ–º
2. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (200):**
```json
{
  "valid": false,
  "message": "–ö–æ–¥ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω, –∏—Å—Ç—ë–∫ –∏–ª–∏ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω",
  "user_name": null
}
```

–ö–æ–¥ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π –∏ –±–æ–ª—å—à–µ –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å.

### –®–∞–≥ 8: –¢–µ—Å—Ç 4 - –ü—Ä–æ–≤–µ—Ä–∫–∞ JWT —Ç–æ–∫–µ–Ω–∞

1. –ù–∞–π–¥–∏—Ç–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç `GET /api/auth/debug-token`
2. –ù–∞–∂–º–∏—Ç–µ "Try it out"
3. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Authorize" –≤–≤–µ—Ä—Ö—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã
4. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —à–∞–≥–∞ (–±–µ–∑ —Å–ª–æ–≤–∞ "Bearer")
5. –ù–∞–∂–º–∏—Ç–µ "Authorize", –∑–∞—Ç–µ–º "Close"
6. –ù–∞–∂–º–∏—Ç–µ "Execute"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (200):**
```json
{
  "jwt_payload": {
    "sub": "tg_5035505042",
    "iat": 1234567890,
    "exp": 1234613490,
    "role": "participant"
  },
  "participant_ids": ["u1", "u2", ...]
}
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ curl (–∫–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)

### 1. –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞ (—á–µ—Ä–µ–∑ Telegram)

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞:

```bash
curl -X GET "http://localhost:8000/api/auth/bot-code/validate/–í–ê–®_–ö–û–î" \
  -H "accept: application/json"
```

### 3. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:

```bash
curl -X POST "http://localhost:8000/api/auth/bot-code" \
  -H "accept: application/json" \
  -H "Content-Type: application/json" \
  -d '{"code": "–í–ê–®_–ö–û–î"}'
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞:

```bash
curl -X GET "http://localhost:8000/api/auth/debug-token" \
  -H "accept: application/json" \
  -H "Authorization: Bearer –í–ê–®_JWT_–¢–û–ö–ï–ù"
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Python —Å–∫—Ä–∏–ø—Ç

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `test_auth.py`:

```python
import requests

API_URL = "http://localhost:8000"

# –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞ –≤—Ä—É—á–Ω—É—é
code = input("–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞: ")

# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
print("\n1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞...")
response = requests.get(f"{API_URL}/api/auth/bot-code/validate/{code}")
print(f"–°—Ç–∞—Ç—É—Å: {response.status_code}")
print(f"–û—Ç–≤–µ—Ç: {response.json()}")

if response.json()["valid"]:
    # 2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
    print("\n2. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è...")
    response = requests.post(
        f"{API_URL}/api/auth/bot-code",
        json={"code": code}
    )
    print(f"–°—Ç–∞—Ç—É—Å: {response.status_code}")
    data = response.json()
    print(f"–û—Ç–≤–µ—Ç: {data}")
    
    if "access_token" in data:
        token = data["access_token"]
        
        # 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
        print("\n3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞...")
        response = requests.get(
            f"{API_URL}/api/auth/debug-token",
            headers={"Authorization": f"Bearer {token}"}
        )
        print(f"–°—Ç–∞—Ç—É—Å: {response.status_code}")
        print(f"–û—Ç–≤–µ—Ç: {response.json()}")
        
        print("\n‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã!")
    else:
        print("‚ùå –ù–µ –ø–æ–ª—É—á–µ–Ω —Ç–æ–∫–µ–Ω")
else:
    print("‚ùå –ö–æ–¥ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω")
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ:
```bash
python3 test_auth.py
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º

### –°–∏–º—É–ª—è—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞:

1. –ü–æ–ª—É—á–∏—Ç–µ –∫–æ–¥ –æ—Ç –±–æ—Ç–∞
2. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: `http://localhost:3000/auth?code=–í–ê–®_–ö–û–î`
3. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–æ–ª–∂–µ–Ω:
   - –ü—Ä–æ—á–∏—Ç–∞—Ç—å `code` –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
   - –í—ã–∑–≤–∞—Ç—å `GET /api/auth/bot-code/validate/{code}`
   - –ï—Å–ª–∏ –∫–æ–¥ –≤–∞–ª–∏–¥–µ–Ω, –≤—ã–∑–≤–∞—Ç—å `POST /api/auth/bot-code`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω –≤ localStorage
   - –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### ‚ùå "–ö–æ–¥ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω"
- –ö–æ–¥ –∏—Å—Ç—ë–∫ (–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω 5 –º–∏–Ω—É—Ç)
- –ö–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
- –ö–æ–¥ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:** –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π –∫–æ–¥ –æ—Ç –±–æ—Ç–∞ –∫–æ–º–∞–Ω–¥–æ–π `/login`

### ‚ùå "Connection refused"
- –ë—ç–∫–µ–Ω–¥ –Ω–µ –∑–∞–ø—É—â–µ–Ω
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—Ç

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 8000

### ‚ùå "ModuleNotFoundError"
- –ù–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

**–†–µ—à–µ–Ω–∏–µ:** 
```bash
pip install -r requirements.txt
```

### ‚ùå –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω
- –ë–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `TELEGRAM_BOT_TOKEN` –∏ —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω

## –£—Å–ø–µ—à–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ï—Å–ª–∏ –≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ, –≤—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
- ‚úÖ –ö–æ–¥ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
- ‚úÖ –ü–æ–ª—É—á–µ–Ω JWT —Ç–æ–∫–µ–Ω
- ‚úÖ –¢–æ–∫–µ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- ‚úÖ –ö–æ–¥ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–π

–¢–µ–ø–µ—Ä—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç! üéâ

